<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta http-equiv=Content-Security-Policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self'; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com https://cdn.jsdelivr.net/; prefetch-src 'self'; connect-src 'self' https://www.google-analytics.com;"><meta name=author content="Brian Osborne"><meta name=description content="I&rsquo;ve been working on a project that requires the search block look a very specific way. The text input and submit button needed to be directly next to one another. I could probably get it done with just CSS, but all the extra markup in the search block was really bothering me.
I&rsquo;ve heard great things about Drupal 7&rsquo;s new rendering system, but it was pretty mysterious to me. I remember attending a session about it @ DrupalCon Chicago but it was a bit over my head at the time."><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Modifying FAPI output with Drupal 7's renderable arrays"><meta name=twitter:description content="I&rsquo;ve been working on a project that requires the search block look a very specific way. The text input and submit button needed to be directly next to one another. I could probably get it done with just CSS, but all the extra markup in the search block was really bothering me.
I&rsquo;ve heard great things about Drupal 7&rsquo;s new rendering system, but it was pretty mysterious to me. I remember attending a session about it @ DrupalCon Chicago but it was a bit over my head at the time."><meta property="og:title" content="Modifying FAPI output with Drupal 7's renderable arrays"><meta property="og:description" content="I&rsquo;ve been working on a project that requires the search block look a very specific way. The text input and submit button needed to be directly next to one another. I could probably get it done with just CSS, but all the extra markup in the search block was really bothering me.
I&rsquo;ve heard great things about Drupal 7&rsquo;s new rendering system, but it was pretty mysterious to me. I remember attending a session about it @ DrupalCon Chicago but it was a bit over my head at the time."><meta property="og:type" content="article"><meta property="og:url" content="http://bkosborne.com/blog/modifying-fapi-output-with-drupal-7s-renderable-arrays/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2012-01-24T00:00:00+00:00"><meta property="article:modified_time" content="2012-01-24T00:00:00+00:00"><title>Modifying FAPI output with Drupal 7's renderable arrays · Brian Osborne
</title><link rel=canonical href=http://bkosborne.com/blog/modifying-fapi-output-with-drupal-7s-renderable-arrays/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.d9fddbffe6f27e69985dc5fe0471cdb0e57fbf4775714bc3d847accb08f4a1f6.css integrity="sha256-2f3b/+byfmmYXcX+BHHNsOV/v0d1cUvD2Eesywj0ofY=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.002ee2378e14c7a68f1f0a53d9694ed252090987c4e768023fac694a4fc5f793.css integrity="sha256-AC7iN44Ux6aPHwpT2WlO0lIJCYfE52gCP6xpSk/F95M=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><meta name=generator content="Hugo 0.124.1"></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Brian Osborne
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/about/>About</a></li><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=http://bkosborne.com/blog/modifying-fapi-output-with-drupal-7s-renderable-arrays/>Modifying FAPI output with Drupal 7's renderable arrays</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2012-01-24T00:00:00Z>January 24, 2012
</time></span><span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
2-minute read</span></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/drupal-planet/>Drupal Planet</a></span></div></div></header><div><p>I&rsquo;ve been working on a project that requires the search block look a very specific way. The text input and submit button needed to be directly next to one another. I could probably get it done with just CSS, but all the extra markup in the search block was really bothering me.</p><p>I&rsquo;ve heard great things about Drupal 7&rsquo;s new rendering system, but it was pretty mysterious to me. I remember attending a session about it @ DrupalCon Chicago but it was a bit over my head at the time. Now that I had to mess around with this search block, it was a great opportunity to research the drupal_render(). FAPI adds what are called theme_wrapper functions to every element before they get rendered. These are like &ldquo;mini&rdquo; theme functions that are applied, in order, to each element they are attached to.</p><p>For the search block, there are two elements that I wanted to remove extra, unnecessary markup from. The search input field is one, and has a theme_wrapper function called &ldquo;form_element&rdquo;. When drupal_render renders this form, it will see that this form element has a theme_wrapper and pass the element data into it for theming. This is when the extra markup around the form element is added. All you have to do is clear out the theme_wrapper before rendering to prevent that from happening. The same applies for the submit button.</p><p>But where do we clear it out? Turns out this <em>can&rsquo;t</em> be done in a form_alter. That&rsquo;s because the theme_wrappers are not added by the time your module gets it&rsquo;s hands on the form. Thanks to Drupal 7&rsquo;s new rendering, you can use a <a href=http://api.drupal.org/api/drupal/modules--block--block.api.php/function/hook_block_view_alter/7>hook_block_view_alter</a> to unset the theme_wrapper functions. Since a blocks $content variable is populated with a renderable array and not static content (like it was in Drupal 6!), we can modify with the fully populated form array using this hook. What&rsquo;s even greater is that you can use this hook in your theme&rsquo;s template.php file, which I don&rsquo;t believe was possible in Drupal 6.</p><p>Here&rsquo;s the code:</p><pre><code>function YOURTHEMENAME_block_view_alter(&amp;$data, $block) {
  if ($block-&gt;module == 'search' &amp;&amp; $block-&gt;bid == 'search-form') {
    unset($data['content']['actions']['#theme_wrappers']);
    unset($data['content']['search_block_form']['#theme_wrappers']);
  }
}
</code></pre><p>And there you go. Now the extra markup around the form elements will be removed.</p></div><footer><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//bkosborne.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></footer></article></section></div><footer class=footer><section class=container>©
2010 -
2024
Brian Osborne
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.9cf2dbf9b6989ef8eae941ffb4231c26d1dc026bca38f1d19fdba50177d8a9ac.js integrity="sha256-nPLb+baYnvjq6UH/tCMcJtHcAmvKOPHRn9ulAXfYqaw="></script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "bd8a23ecd0e34c58a89099ab25d009a"}'></script></body></html>